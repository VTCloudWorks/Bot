# Blazed A.I Sports Tracker

Blazed A.I Sports Tracker is a Discord bot that delivers real-time scoreboards for major North American sports leagues (NFL, NBA, MLB, and NHL). The bot can drop beautifully formatted embeds into any Discord channel, auto-refresh live games, and let community members track specific matchups without leaving their server.

This README is intentionally **extremely detailed** so that a new contributor can understand the codebase, stand up an environment in minutes, and operate the bot confidently.

---

## Table of Contents

1. [Project Structure](#project-structure)
2. [Key Features](#key-features)
3. [System Architecture](#system-architecture)
   - [High-level Flow](#high-level-flow)
   - [Modules](#modules)
4. [Discord Command Reference](#discord-command-reference)
5. [Dependencies](#dependencies)
6. [Configuration](#configuration)
   - [Environment Variables](#environment-variables)
   - [Update Interval](#update-interval)
7. [Local Development](#local-development)
   - [Prerequisites](#prerequisites)
   - [Installation](#installation)
   - [Running the Bot](#running-the-bot)
   - [Common Local Workflows](#common-local-workflows)
8. [How Auto-Updating Embeds Work](#how-auto-updating-embeds-work)
9. [ESPN Scoreboard Integration](#espn-scoreboard-integration)
10. [Extending the Bot](#extending-the-bot)
    - [Adding a New League](#adding-a-new-league)
    - [Adding a New Command](#adding-a-new-command)
11. [Logging & Troubleshooting](#logging--troubleshooting)
12. [Testing](#testing)
13. [Deployment Tips](#deployment-tips)
14. [Contributing](#contributing)
15. [License](#license)

---

## Project Structure

```text
./
├── README.md                # This document
├── main.py                  # Placeholder entry point when using the repo root
├── pyproject.toml           # Poetry/UV compatible dependency manifest
├── uv.lock                  # Locked dependency versions for deterministic installs
├── SportyScores/            # Discord bot implementation
│   ├── README.md            # Legacy or minimal project notes
│   ├── main.py              # Async Discord client bootstrapper
│   ├── bot_commands.py      # Discord command cog and embed helpers
│   ├── sports_api.py        # ESPN API client and parsing logic
│   ├── config.py            # Configuration values, league metadata, .env loader
│   ├── pyproject.toml       # Local package definition (mirrors root dependencies)
│   ├── replit.md            # Replit-specific instructions (if using Replit)
│   └── uv.lock              # Dependency lock file for the SportyScores package
└── replit.md                # Workspace notes for Replit
```

The code that powers the bot lives entirely under `SportyScores/`. The root-level `main.py` is a placeholder generated by the template and can usually be ignored.

---

## Key Features

- **Real-time score fetching** using ESPN's public scoreboard endpoints for NFL, NBA, MLB, and NHL.
- **Auto-updating Discord embeds** that refresh every 30 seconds while games are live.
- **Per-game tracking**: selectively follow individual matchups or entire leagues.
- **Rich status information** including live clocks, periods/quarters/innings, win-loss records, broadcast info, and situational context (e.g., MLB baserunners, NFL down & distance).
- **Friendly onboarding commands** with helpful error messages, usage hints, and author/branding support.
- **ESPN line score breakdowns** to display scoring by quarter/period when available.

---

## System Architecture

### High-level Flow

1. **Discord Gateway Connection**: `SportyScores/main.py` creates a `discord.ext.commands.Bot` with message content intents enabled.
2. **Cog Registration**: On startup, the bot registers the `ScoreCommands` cog from `bot_commands.py` and schedules the `update_scores` background task.
3. **User Interaction**: Server members call commands such as `!scores` or `!trackgame`. The cog fetches data via `SportsAPI` and renders embed responses.
4. **Background Updates**: The `update_scores` task loops every `UPDATE_INTERVAL` seconds, refreshing tracked game embeds and removing completed games.
5. **Shutdown**: When the bot stops, it gracefully closes the shared `aiohttp.ClientSession` used for ESPN API calls.

### Modules

| Module | Responsibility | Key Classes / Functions |
| --- | --- | --- |
| `SportyScores/main.py` | Discord bot bootstrapper, task scheduler, global error handler | `bot`, `update_scores`, `main()` |
| `SportyScores/bot_commands.py` | Commands, embed generation, game tracking state | `ScoreCommands`, `GameTracker`, `create_game_embed`, `format_score_breakdown`, `format_situation` |
| `SportyScores/sports_api.py` | ESPN API client, data normalization | `SportsAPI.fetch_scores`, `SportsAPI.parse_games` |
| `SportyScores/config.py` | Configuration constants and environment loading | `DISCORD_TOKEN`, `ESPN_API_URLS`, `LEAGUE_COLORS`, `LEAGUE_NAMES`, `UPDATE_INTERVAL` |

---

## Discord Command Reference

All commands use the `!` prefix. Commands are case-insensitive for league arguments.

| Command | Parameters | Description |
| --- | --- | --- |
| `!help_sports` | – | Displays a summary of all available sports commands. |
| `!scores [league]` | Optional `league` (`nfl`, `nba`, `mlb`, `nhl`) | Sends current scoreboard embeds. If no league is given, the bot cycles through all supported leagues. |
| `!games [league]` | Optional `league` | Lists games with indexes so you can target an individual matchup. |
| `!track [league]` | Optional `league` | Begins tracking all live games in the specified league(s). Each tracked game receives an auto-updating embed. |
| `!trackgame <league> <number>` | Required `league` and `game_number` from `!games` output | Tracks a single game and schedules it for auto-updates. |
| `!stoptrack` | – | Stops tracking every game and halts auto-updates until a new tracking command is issued. |

When invalid input is provided (e.g., `!scores soccer`), the bot sends a branded error embed detailing the correct usage.

---

## Dependencies

| Package | Purpose |
| --- | --- |
| [`discord.py`](https://discordpy.readthedocs.io/en/stable/) | Discord gateway client and command framework. |
| [`aiohttp`](https://docs.aiohttp.org/) | Async HTTP client used to call ESPN's APIs. |
| [`python-dotenv`](https://saurabh-kumar.com/python-dotenv/) | Loads environment variables from a `.env` file during local development. |

The dependencies are declared in the root `pyproject.toml`. UV or Poetry can install them, and the provided `uv.lock` ensures repeatable builds.

---

## Configuration

### Environment Variables

Create a `.env` file at the repository root (or ensure the variable exists in your hosting environment) with the following key:

```env
DISCORD_BOT_TOKEN=your_discord_bot_token_here
```

- **`DISCORD_BOT_TOKEN`**: The bot token obtained from the Discord Developer Portal. The token is consumed in `SportyScores/config.py`.
- The project automatically loads `.env` files via `python-dotenv`. If you run the bot inside a platform like Docker or Replit, inject the variable through their configuration UI instead of a local file.

### Update Interval

`SportyScores/config.py` exposes `UPDATE_INTERVAL` (default 30 seconds). This value controls how frequently tracked game embeds are refreshed.

- Lowering the interval makes scores appear more quickly but increases API calls.
- Raising the interval reduces API load but may cause updates to lag.
- Any change applies globally because the interval feeds the `@tasks.loop` decorator in `SportyScores/main.py`.

---

## Local Development

### Prerequisites

- Python **3.11+** (matching the `requires-python` field in `pyproject.toml`).
- `uv` (recommended) or `pip`/`poetry` for dependency management.
- A Discord application with a bot token and the *Message Content Intent* enabled.

### Installation

1. **Clone the repository**:
   ```bash
   git clone <your-fork-url>
   cd Bot
   ```
2. **Create and activate a virtual environment** (using `uv`):
   ```bash
   uv venv
   source .venv/bin/activate
   ```
   If you prefer `python -m venv` or Poetry, feel free to use those tools.
3. **Install dependencies**:
   ```bash
   uv pip install -r uv.lock
   ```
   or, if you are using `pip`:
   ```bash
   pip install -e .
   ```
4. **Configure environment variables** by adding `.env` as described above.

### Running the Bot

From the repository root:

```bash
cd SportyScores
python -m main
```

Key notes:
- `python -m main` ensures the module is executed using the package’s relative imports.
- On successful startup, the console prints the bot’s username and the number of guilds it joined.
- The auto-update loop begins immediately after startup.

### Common Local Workflows

- **Test specific commands**: Invite the bot to a private Discord server you control and issue commands from a test channel.
- **Network monitoring**: Use developer tools or logging statements inside `SportsAPI.fetch_scores` if you need to inspect the raw ESPN payloads.
- **Hot reloading**: The bot does not include autoreload tooling. Restart the process after code changes.

---

## How Auto-Updating Embeds Work

1. When `!track`, `!trackgame`, or other tracking commands run, the cog stores a `discord.Message` reference plus metadata inside `GameTracker.tracked_messages`.
2. The `update_scores` background task (defined in `SportyScores/main.py`) wakes up every `UPDATE_INTERVAL` seconds.
3. For each tracked game, it re-fetches the relevant league’s scoreboard data, finds the matching game by ID, and compares the new score to the cached `last_score`.
4. If the score changed or the game finished, the task regenerates the embed via `create_game_embed` and edits the original message in place. Completed games are removed from the tracker.
5. If a tracked message is manually deleted, the code gracefully catches `discord.errors.NotFound` and prunes the tracker entry.

This design keeps Discord channels tidy—messages are edited in place instead of spamming new updates.

---

## ESPN Scoreboard Integration

- **Endpoints**: Stored in `ESPN_API_URLS`. Each league maps to an ESPN scoreboard endpoint that returns JSON.
- **HTTP Client**: `aiohttp.ClientSession` handles async requests. The session is created on-demand to avoid unnecessary connections.
- **Parsing**: `SportsAPI.parse_games` normalizes ESPN’s event data into a consistent dictionary that downstream code can rely on.
  - Includes metadata like team colors, logos, records, venue, broadcasts, odds, and situational data.
  - Safely handles missing fields by defaulting to empty strings or fallback values.
- **Error Handling**: Exceptions during fetch or parse are logged to stdout so operators can monitor transient failures.

---

## Extending the Bot

### Adding a New League

1. **Add endpoint and metadata** in `SportyScores/config.py` (`ESPN_API_URLS`, `LEAGUE_COLORS`, `LEAGUE_NAMES`).
2. **Update validation lists** in `bot_commands.py` where commands check allowed leagues.
3. **Enhance embed helpers** (`get_period_name`, `format_situation`, `format_score_breakdown`) to support the league’s scoring format.
4. **Test commands** manually to ensure the new league appears in `!scores`, `!games`, `!track`, etc.

### Adding a New Command

1. **Create a method** in `ScoreCommands` decorated with `@commands.command`.
2. **Inject dependencies** (e.g., reuse `self.sports_api` or `self.game_tracker` as needed).
3. **Return responses** using embeds to match the existing style guidelines.
4. **Update documentation** (this README and `!help_sports`) to describe the new command.

---

## Logging & Troubleshooting

- **Startup Logs**: On `on_ready`, the bot prints the connected username and guild count.
- **Score Updates**: Console messages show whenever a game is updated or removed from tracking.
- **Errors**: Unexpected exceptions in `update_scores` or command handlers surface in the console. Discord-side errors are also shown to users via embeds.
- **Connection Issues**: Ensure the bot has the *Message Content Intent* enabled in the Discord Developer Portal; otherwise commands may never trigger.

Common symptoms & fixes:

| Symptom | Possible Cause | Resolution |
| --- | --- | --- |
| Bot replies with "Could not fetch scores" | ESPN API unreachable or rate-limited | Retry later; inspect logs for HTTP status codes. |
| Commands ignored | Missing privileged intents or insufficient channel permissions | Update bot intents and ensure the bot can view/send messages in the channel. |
| Embeds stop updating | Bot lost Discord connection or encountered an exception | Check logs, then restart the bot after addressing the root cause. |

---

## Testing

The project currently relies on manual testing through Discord interactions. Recommended practices:

1. Run the bot in a staging Discord server.
2. Execute each command (`!scores`, `!games`, `!track`, etc.) across different leagues.
3. Simulate edge cases by testing during times with no scheduled games, completed games, and active games.
4. Optionally mock ESPN responses when writing future unit tests for `SportsAPI.parse_games`.

Automated tests are not yet implemented, but the modular structure makes it straightforward to add them using `pytest`.

---

## Deployment Tips

- **Hosting Platforms**: Works well on VPS, Docker containers, or serverless platforms that support long-lived processes (e.g., Railway, Fly.io, Render). Ensure the runtime supports Python 3.11+.
- **Process Managers**: Use `systemd`, `pm2`, or `supervisord` to keep the bot running and restart on failure.
- **Secrets Management**: Avoid hardcoding the Discord token. Use environment variables or a secrets manager. Rotate tokens immediately if they leak.
- **Monitoring**: Pipe stdout/stderr to a logging solution (CloudWatch, LogDNA, Papertrail, etc.) to keep tabs on score updates and exceptions.

---

## Contributing

1. Fork the repository and create a new branch: `git checkout -b feature/my-awesome-change`.
2. Follow the [Local Development](#local-development) steps to set up your environment.
3. Ensure new commands or features come with documentation updates (README + `!help_sports`).
4. Submit a pull request with a clear description, screenshots or GIFs if UI/UX changes are involved, and thorough testing notes.
5. Be responsive to feedback—code reviews are collaborative and improve the bot for everyone.

---

## License

This project currently does not include an explicit license. Until one is added, assume all rights are reserved by the repository owner. Contact the maintainers if you plan to use the bot beyond personal experimentation.

